<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Home</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Hero Section -->
        <div class="hero-section mb-4">
            <div class="row align-items-center">
                <div class="col-lg-7">
                    <h1>Track Your Places</h1>
                    <p class="lead">Document your journeys to memorable places. Record visits, capture moments, and build your travel legacy.</p>
                    <hr>
                    <div class="d-flex gap-3 flex-wrap">
                        <a class="btn btn-success" th:href="@{/places/new}">
                            <i class="bi bi-plus-lg me-2"></i>Add New Place
                        </a>
                        <a class="btn btn-light" th:href="@{/places}">
                            <i class="bi bi-compass me-2"></i>Explore Places
                        </a>
                    </div>
                </div>
                <div class="col-lg-5 text-center mt-4 mt-lg-0">
                    <span class="stat-highlight" th:text="${totalPlaces}">0</span>
                    <span style="font-size: 1rem; color: var(--text-secondary); display: block;">Places Explored</span>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="row g-4 mb-4">
            <div class="col-md-4 col-lg">
                <div class="stat-card">
                    <div class="stat-label">Visited Places</div>
                    <div class="stat-value" th:text="${totalPlaces}">0</div>
                    <a th:href="@{/places}" class="stat-indicator positive">
                        View all <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            <div class="col-md-4 col-lg">
                <div class="stat-card">
                    <div class="stat-label">Total Visits</div>
                    <div class="stat-value" th:text="${totalVisits != null ? totalVisits : 0}">0</div>
                    <span class="stat-indicator positive">
                        <i class="bi bi-calendar-check"></i> All time
                    </span>
                </div>
            </div>
            <div class="col-md-4 col-lg">
                <div class="stat-card">
                    <div class="stat-label">Wishlist</div>
                    <div class="stat-value" th:text="${wishlistCount != null ? wishlistCount : 0}">0</div>
                    <a th:href="@{/places/wishlist}" class="stat-indicator positive">
                        <i class="bi bi-bookmark-star"></i> View list
                    </a>
                </div>
            </div>
            <div class="col-md-4 col-lg">
                <div class="stat-card">
                    <div class="stat-label">Favorites</div>
                    <div class="stat-value" th:text="${favoritesCount != null ? favoritesCount : 0}">0</div>
                    <a th:href="@{/places/favorites}" class="stat-indicator positive">
                        <i class="bi bi-star-fill"></i> View all
                    </a>
                </div>
            </div>
            <div class="col-md-4 col-lg">
                <div class="stat-card">
                    <div class="stat-label">Home Base</div>
                    <div th:if="${homeLocationSet}">
                        <div class="stat-value" style="color: var(--primary-600);">
                            <i class="bi bi-check-lg"></i>
                        </div>
                        <a th:href="@{/settings}" class="stat-indicator positive">
                            <i class="bi bi-geo-alt"></i> Configured
                        </a>
                    </div>
                    <div th:unless="${homeLocationSet}">
                        <div class="stat-value" style="color: var(--warning-500);">
                            <i class="bi bi-dash-lg"></i>
                        </div>
                        <a th:href="@{/settings}" class="stat-indicator warning">
                            <i class="bi bi-arrow-right"></i> Set location
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Home Location Warning -->
        <div th:unless="${homeLocationSet}" class="alert alert-warning mb-4">
            <i class="bi bi-geo-alt me-2"></i>
            <strong>Home location not configured.</strong>
            Set your home base to see distances to each place.
            <a th:href="@{/settings}" class="alert-link ms-1">Configure now â†’</a>
        </div>

        <!-- Recent Places -->
        <div th:if="${recentPlaces != null and !recentPlaces.isEmpty()}">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0" style="font-size: 1.25rem;">Recent Places</h2>
                <a th:href="@{/places}" class="btn btn-sm btn-outline-success">
                    View all <i class="bi bi-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4" th:each="place : ${recentPlaces}">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="mb-0" style="font-family: var(--font-display); font-size: 1.125rem;" th:text="${place.name}">Place Name</h5>
                                <span class="badge bg-success" th:text="${place.visitCount}">0</span>
                            </div>
                            <p class="small mb-3" style="color: var(--text-tertiary);">
                                <i class="bi bi-geo-alt me-1"></i>
                                <span th:text="${place.location}">Location</span>,
                                <span th:text="${place.state}">State</span>
                            </p>
                            <div th:with="latestVisit=${place.getMostRecentVisit().orElse(null)}">
                                <p class="small mb-2" th:if="${latestVisit != null}" style="color: var(--text-secondary);">
                                    <i class="bi bi-calendar3 me-1" style="color: var(--primary-600);"></i>
                                    <span th:text="${#temporals.format(latestVisit.date(), 'MMM d, yyyy')}">Date</span>
                                </p>
                                <p class="small mb-0"
                                   style="color: var(--text-tertiary);"
                                   th:if="${latestVisit != null and latestVisit.notes() != null and !latestVisit.notes().isBlank()}"
                                   th:text="${#strings.abbreviate(latestVisit.notes(), 70)}">Notes...</p>
                            </div>
                        </div>
                        <div class="card-footer">
                            <a th:href="@{/places/{id}(id=${place.id})}" class="btn btn-sm btn-success w-100">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${recentPlaces == null or recentPlaces.isEmpty()}" class="empty-state">
            <div class="empty-state-icon">
                <i class="bi bi-geo-alt"></i>
            </div>
            <h3>No places yet</h3>
            <p>Start documenting your adventures</p>
            <a class="btn btn-success btn-lg" th:href="@{/places/new}">
                <i class="bi bi-plus-lg me-2"></i>Add Your First Place
            </a>
        </div>
    </div>
</body>
</html>
